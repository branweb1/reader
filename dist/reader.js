var SpeedOp,__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(c,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?c(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})};!function(e){e[e.Inc=0]="Inc",e[e.Dec=1]="Dec"}(SpeedOp||(SpeedOp={}));const RED_LETTER_OFFSET=5;let WPM=320,VISIBLE=!1;function calcRedIdx(e){let t;const n=e.length;return t=1===n?0:n<=3?1:n<8?2:3}function splitter(e){return concatMap(e=>e.split(/(\w+\-)/),e.split(/\s+/)).filter(idFunc)}function makeWord(e){const t=calcRedIdx(e);return leftpad(e.substring(0,t)," ",RED_LETTER_OFFSET-t)+`<span class="red-letter">${e.charAt(t)}</span>`+e.substring(t+1)}function calcSleepTime(e,t){let n=6e4/t;const r=e.slice(-1);return/[\.\!\;]/.test(r)?n+=230:/[\-\,\:]/.test(r)&&(n+=100),n}function concatMap(e,t){return t.reduce((t,n)=>[...t,...e(n)],[])}function idFunc(e){return e}function leftpad(e,t,n){let r="";for(let e=0;e<n;e++)r+=t;return r+e}function sleep(e){return new Promise(t=>setTimeout(t,e))}function extractTextArea(){const e=document.querySelector("textArea");return e?e.value:""}function extractTextAreaSelection(){const e=document.querySelector("textArea"),t=e.selectionStart,n=e.selectionEnd;return e?e.value.substring(t,n):""}function extractPageSelection(){return window.getSelection().toString()}function extractText(){const e=extractPageSelection();return e||(extractTextAreaSelection()||extractTextArea())}function setBarOffset(e){e.style.visibility="hidden",e.innerHTML=makeWord("dummyword");const t=e.querySelector("span").getBoundingClientRect().width,n=t/2+t*RED_LETTER_OFFSET;[...document.querySelectorAll(".spritz-vert-bar")].forEach(e=>e.style.width=`${n}px`),e.innerHTML=" ",e.style.visibility="initial"}function modWPM(e){return t=>{t.preventDefault(),e===SpeedOp.Inc?WPM+=10:e===SpeedOp.Dec&&(WPM-=10),document.querySelector(".wpm-count").textContent=`${WPM}`}}function cycleWords(e,t){return __awaiter(this,void 0,void 0,function*(){for(let n=0;n<e.length&&VISIBLE;n++){const r=makeWord(e[n]);t.innerHTML=r,yield sleep(calcSleepTime(r,WPM))}})}function readerStop(){const e=document.querySelector("#spritz-container");VISIBLE=!1,e.style.display="none"}function readerSetup(){return __awaiter(this,void 0,void 0,function*(){const e=document.createElement("div"),t=yield fetch("https://branweb1.github.io/reader/dist/reader.html").then(e=>e.text());e.setAttribute("id","spritz-container"),e.innerHTML=t,document.body.appendChild(e);const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","https://branweb1.github.io/reader/dist/style.css");const r=document.querySelector("head");r.insertBefore(n,r.firstChild),document.querySelector(".spritz-close-btn").addEventListener("click",readerStop),document.querySelector(".wpm-increase").addEventListener("click",modWPM(SpeedOp.Inc)),document.querySelector(".wpm-decrease").addEventListener("click",modWPM(SpeedOp.Dec)),document.querySelector(".wpm-count").textContent=`${WPM}`,setBarOffset(document.querySelector("#spritz-display-area"))})}function readerInit(){return __awaiter(this,void 0,void 0,function*(){let e=document.querySelector("#spritz-container");e?e.style.display="flex":(yield readerSetup(),e=document.querySelector("#spritz-container"));const t=document.querySelector("#spritz-display-area");e.style.top=`${window.scrollY+45}px`,VISIBLE=!0,cycleWords(splitter(extractText()),t)})}