var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,c){function o(e){try{u(r.next(e))}catch(e){c(e)}}function s(e){try{u(r.throw(e))}catch(e){c(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})};const RED_LETTER_OFFSET=6;function calcRedIdx(e){let t;const n=e.length;return t=1===n?0:n<=3?1:n<8?2:3}function splitter(e){return concatMap(e=>e.split(/(\w+\-)/),e.split(/\s+/)).filter(idFunc)}function makeWord(e){const t=calcRedIdx(e);return leftpad(e.substring(0,t)," ",RED_LETTER_OFFSET-t)+`<span style="color:#CC0033;">${e.charAt(t)}</span>`+e.substring(t+1)}function calcSleepTime(e,t){let n=6e4/t;const r=e.slice(-1);return/[\.\!\;]/.test(r)?n+=230:/[\-\,\:]/.test(r)&&(n+=100),n}function concatMap(e,t){return t.reduce((t,n)=>[...t,...e(n)],[])}function idFunc(e){return e}function leftpad(e,t,n){let r="";for(let e=0;e<n;e++)r+=t;return r+e}function sleep(e){return new Promise(t=>setTimeout(t,e))}function extractTextArea(){const e=document.querySelector("textArea");return e?e.value:""}function extractTextAreaSelection(){const e=document.querySelector("textArea"),t=e.selectionStart,n=e.selectionEnd;return e?e.value.substring(t,n):""}function extractPageSelection(){return window.getSelection().toString()}function extractText(){const e=extractPageSelection();return e||(extractTextAreaSelection()||extractTextArea())}function setBarOffset(e){e.style.visibility="hidden",e.innerHTML=makeWord("dummyword");const t=e.querySelector("span").getBoundingClientRect().width,n=t/2+t*RED_LETTER_OFFSET;[...document.querySelectorAll(".spritz-vert-bar")].forEach(e=>e.style.width=`${n}px`),e.innerHTML=" ",e.style.visibility="initial"}let WPM=320;function decWMP(e){e.preventDefault(),WPM-=10,document.querySelector(".wpm-count").textContent=`${WPM}`}function incWMP(e){e.preventDefault(),WPM+=10,document.querySelector(".wpm-count").textContent=`${WPM}`}function showWords(e,t){return __awaiter(this,void 0,void 0,function*(){for(let n=0;n<e.length;n++){const r=makeWord(e[n]);t.innerHTML=r,yield sleep(calcSleepTime(r,WPM))}})}function toggleReaderVisibility(){const e=document.querySelector("#spritz-container");if("none"===e.style.display){e.style.display="flex";const t=document.querySelector("#spritz-display-area");showWords(splitter(extractText()),t)}else e.style.display="none"}function readerMain(){return __awaiter(this,void 0,void 0,function*(){const e=document.createElement("div"),t=yield fetch("https://branweb1.github.io/reader/dist/reader.html").then(e=>e.text()),n=document.createElement("link");e.setAttribute("id","spritz-container"),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","https://branweb1.github.io/reader/dist/style.css"),document.querySelector("head").appendChild(n),e.innerHTML=t,document.body.appendChild(e);const r=document.querySelector("#spritz-display-area");document.querySelector(".spritz-close-btn").addEventListener("click",toggleReaderVisibility),document.querySelector(".wpm-increase").addEventListener("click",incWMP),document.querySelector(".wpm-decrease").addEventListener("click",decWMP),document.querySelector(".wpm-count").textContent=`${WPM}`,setBarOffset(r),showWords(splitter(extractText()),r)})}readerMain();